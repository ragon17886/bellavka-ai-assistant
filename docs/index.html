<!DOCTYPE html>
<html>
<head>
    <title>Bellavka Admin - Direct D1</title>
    <style>
        body { font-family: Arial; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 6px; }
        .nav { background: #2c3e50; padding: 15px; border-radius: 6px; }
        .nav button { background: #3498db; color: white; border: none; padding: 10px 15px; margin: 0 5px; border-radius: 4px; cursor: pointer; }
        .nav button:hover { background: #2980b9; }
        .data-section { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 4px; }
        pre { background: #2c3e50; color: white; padding: 15px; border-radius: 4px; overflow: auto; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè™ Bellavka Admin - Database Manager</h1>
        
        <div class="nav">
            <button onclick="loadTable('users')">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
            <button onclick="loadTable('dialogs')">üí¨ –î–∏–∞–ª–æ–≥–∏</button>
            <button onclick="loadTable('assistants')">ü§ñ –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç—ã</button>
            <button onclick="runCustomQuery()">üîß –ü—Ä—è–º–æ–π SQL</button>
        </div>

        <div class="section">
            <h3>üìä –î–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã:</h3>
            <div id="data-result">
                <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–∞–Ω–Ω—ã—Ö</p>
            </div>
        </div>

        <div class="section">
            <h3>‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:</h3>
            <button onclick="createTestData()">‚ûï –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
            <button onclick="checkTables()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã</button>
            <button onclick="clearAllData()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
        </div>
    </div>

    <script>
        const WORKER_URL = 'https://bellavka-ai-assistant-worker.ragon17886.workers.dev';

        async function loadTable(tableName) {
            try {
                showLoading(`–ó–∞–≥—Ä—É–∑–∫–∞ ${tableName}...`);
                
                const response = await fetch(`${WORKER_URL}/api/admin/direct-query`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        query: `SELECT * FROM ${tableName} ORDER BY id DESC LIMIT 50`
                    })
                });
                
                const result = await response.json();
                
                if (result.success && result.data) {
                    showData(tableName, result.data);
                } else {
                    showError(`–û—à–∏–±–∫–∞: ${result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
                }
                
            } catch (error) {
                showError(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}`);
            }
        }

        async function runCustomQuery() {
            const query = prompt('–í–≤–µ–¥–∏—Ç–µ SQL –∑–∞–ø—Ä–æ—Å:', 'SELECT name FROM sqlite_master WHERE type="table"');
            if (!query) return;
            
            try {
                showLoading(`–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞...`);
                
                const response = await fetch(`${WORKER_URL}/api/admin/direct-query`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showData('–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞', result.data);
                } else {
                    showError(`–û—à–∏–±–∫–∞: ${result.error}`);
                }
                
            } catch (error) {
                showError(`–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }

        async function createTestData() {
            try {
                showLoading('–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö...');
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                await fetch(`${WORKER_URL}/api/admin/direct-query`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        query: `INSERT INTO users (tg_id, full_name, last_activity) VALUES (123456, '–¢–µ—Å—Ç–æ–≤—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', CURRENT_TIMESTAMP)`
                    })
                });
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –¥–∏–∞–ª–æ–≥
                await fetch(`${WORKER_URL}/api/admin/direct-query`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        query: `INSERT INTO dialogs (session_id, tg_id, role, content) VALUES ('test_123456_${Date.now()}', 123456, 'user', '–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ')`
                    })
                });
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
                await fetch(`${WORKER_URL}/api/admin/direct-query`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        query: `INSERT INTO assistants (id, name, type, system_prompt, is_active) VALUES ('test_${Date.now()}', '–¢–µ—Å—Ç–æ–≤—ã–π –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç', 'ai', '–¢—ã —Ç–µ—Å—Ç–æ–≤—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç', 1)`
                    })
                });
                
                showSuccess('–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω—ã!');
                loadTable('users');
                
            } catch (error) {
                showError(`–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ${error.message}`);
            }
        }

        async function checkTables() {
            try {
                showLoading('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü...');
                
                const response = await fetch(`${WORKER_URL}/api/admin/direct-query`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        query: `SELECT name FROM sqlite_master WHERE type='table'`
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showData('–¢–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ', result.data);
                } else {
                    showError(`–û—à–∏–±–∫–∞: ${result.error}`);
                }
                
            } catch (error) {
                showError(`–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }

        function showLoading(message) {
            document.getElementById('data-result').innerHTML = `<p>‚è≥ ${message}</p>`;
        }

        function showData(title, data) {
            const count = Array.isArray(data) ? data.length : 0;
            document.getElementById('data-result').innerHTML = `
                <div class="data-section">
                    <h4>${title} (${count} –∑–∞–ø–∏—Å–µ–π)</h4>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                </div>
            `;
        }

        function showSuccess(message) {
            document.getElementById('data-result').innerHTML = `<div class="success">‚úÖ ${message}</div>`;
        }

        function showError(message) {
            document.getElementById('data-result').innerHTML = `<div class="error">‚ùå ${message}</div>`;
        }

        // –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ —Ç–∞–±–ª–∏—Ü –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        checkTables();
    </script>
</body>
</html>